import type { Unit, Lesson, Exercise } from '@/lib/types';

// ============================================
// B2 - UNIT 2: PAST PERFECT
// Topics: Had + past participle, time sequencing, earlier past actions
// 15 lessons, ~10 exercises each
// ============================================

// ============================================
// LESSON 1: Introduction and Formation
// ============================================
const lesson1: Lesson = {
  id: 'b2-u2-l1',
  unitId: 'b2-u2',
  title: 'Introduction and Formation',
  description: 'Learn the basic structure: had + past participle',
  order: 1,
  xpReward: 20,
  grammarPoint: 'Past perfect: had + past participle',
  vocabularyWords: ['had finished', 'had left', 'had arrived', 'had eaten', 'had seen', 'had gone', 'had been', 'had done'],
  exercises: [
    {
      id: 'b2-u2-l1-e1',
      type: 'multiple-choice',
      instruction: 'Select the correct answer',
      question: 'How do we form the past perfect tense?',
      options: ['had + past participle', 'has + past participle', 'have + past participle', 'had + base verb'],
      correctAnswer: 0,
      explanation: 'The past perfect uses "had" + past participle for all subjects.',
      points: 10,
    },
    {
      id: 'b2-u2-l1-e2',
      type: 'fill-blank',
      instruction: 'Complete the sentence with the correct form',
      question: 'By the time I arrived, they ___ (leave).',
      correctAnswer: 'had left',
      explanation: 'Past perfect: had + left (past participle).',
      points: 10,
    },
    {
      id: 'b2-u2-l1-e3',
      type: 'matching',
      instruction: 'Match the verb with its past perfect form',
      pairs: [
        { left: 'Finish', right: 'Had finished' },
        { left: 'Eat', right: 'Had eaten' },
        { left: 'Go', right: 'Had gone' },
        { left: 'See', right: 'Had seen' },
      ],
      explanation: 'Past perfect uses "had" + past participle for all verbs.',
      points: 10,
    },
    {
      id: 'b2-u2-l1-e4',
      type: 'multiple-choice',
      instruction: 'Choose the correct form',
      question: '"She ___ already when I called."',
      options: ['had left', 'has left', 'have left', 'leaving'],
      correctAnswer: 0,
      explanation: 'Use past perfect for an action completed before another past action.',
      points: 10,
    },
    {
      id: 'b2-u2-l1-e5',
      type: 'word-order',
      instruction: 'Put the words in the correct order',
      words: ['had', 'finished', 'They', 'homework', 'their'],
      correctOrder: [2, 0, 1, 3, 4],
      explanation: 'Structure: Subject + had + past participle + object.',
      points: 10,
    },
    {
      id: 'b2-u2-l1-e6',
      type: 'true-false',
      instruction: 'Is this statement correct?',
      statement: 'The past perfect uses "had" with the past participle.',
      correctAnswer: true,
      explanation: 'Yes, past perfect = had + past participle.',
      points: 10,
    },
    {
      id: 'b2-u2-l1-e7',
      type: 'fill-blank',
      instruction: 'Complete the sentence with the correct form',
      question: 'He ___ (be) to Paris before 2020.',
      correctAnswer: 'had been',
      explanation: 'Past perfect of "be" is "had been".',
      points: 10,
    },
    {
      id: 'b2-u2-l1-e8',
      type: 'multiple-choice',
      instruction: 'Select the correct answer',
      question: 'Which auxiliary verb is used in past perfect?',
      options: ['Had', 'Has', 'Have', 'Was'],
      correctAnswer: 0,
      explanation: '"Had" is the auxiliary verb for past perfect with all subjects.',
      points: 10,
    },
    {
      id: 'b2-u2-l1-e9',
      type: 'translation',
      instruction: 'Translate to English',
      question: 'Ellos habían terminado antes de que yo llegara.',
      correctAnswer: 'They had finished before I arrived',
      acceptableAnswers: ['They had finished before I arrived.'],
      explanation: '"Habían terminado" = "had finished" (past perfect).',
      points: 10,
    },
    {
      id: 'b2-u2-l1-e10',
      type: 'error-correction',
      instruction: 'Find and correct the error',
      sentence: 'She has done her homework before dinner yesterday.',
      correctAnswer: 'She had done her homework before dinner yesterday.',
      explanation: '"Yesterday" requires past perfect "had done", not present perfect "has done".',
      points: 10,
    },
  ],
};

// ============================================
// LESSON 2: The Earlier Past Action
// ============================================
const lesson2: Lesson = {
  id: 'b2-u2-l2',
  unitId: 'b2-u2',
  title: 'The Earlier Past Action',
  description: 'Use past perfect for actions that happened before other past actions',
  order: 2,
  xpReward: 20,
  grammarPoint: 'Past perfect for earlier past events',
  vocabularyWords: ['before', 'earlier', 'previously', 'prior to', 'already', 'yet', 'just', 'never'],
  exercises: [
    {
      id: 'b2-u2-l2-e1',
      type: 'multiple-choice',
      instruction: 'Select the correct answer',
      question: 'When I arrived at the station, the train ___ (leave).',
      options: ['had left', 'left', 'has left', 'leaves'],
      correctAnswer: 0,
      explanation: 'The train left before I arrived, so use past perfect.',
      points: 10,
    },
    {
      id: 'b2-u2-l2-e2',
      type: 'fill-blank',
      instruction: 'Complete the sentence with the correct form',
      question: 'She was tired because she ___ (work) all day.',
      correctAnswer: 'had worked',
      explanation: 'The work happened before being tired, so use past perfect.',
      points: 10,
    },
    {
      id: 'b2-u2-l2-e3',
      type: 'matching',
      instruction: 'Match the earlier action with the later one',
      pairs: [
        { left: 'Had studied (earlier)', right: 'Passed the test (later)' },
        { left: 'Had eaten (earlier)', right: 'Wasn\'t hungry (later)' },
        { left: 'Had missed the bus (earlier)', right: 'Was late (later)' },
        { left: 'Had finished work (earlier)', right: 'Went home (later)' },
      ],
      explanation: 'Past perfect shows which action happened first.',
      points: 10,
    },
    {
      id: 'b2-u2-l2-e4',
      type: 'multiple-choice',
      instruction: 'Choose the correct form',
      question: '"I wasn\'t hungry because I ___ lunch."',
      options: ['had eaten', 'ate', 'have eaten', 'was eating'],
      correctAnswer: 0,
      explanation: 'Eating lunch happened before not being hungry.',
      points: 10,
    },
    {
      id: 'b2-u2-l2-e5',
      type: 'word-order',
      instruction: 'Put the words in the correct order',
      words: ['arrived', 'everyone', 'When', 'had', 'left', 'I'],
      correctOrder: [2, 5, 1, 0, 3, 4],
      explanation: 'When + past simple, + subject + had + past participle.',
      points: 10,
    },
    {
      id: 'b2-u2-l2-e6',
      type: 'true-false',
      instruction: 'Is this statement correct?',
      statement: 'Past perfect shows an action happened before another past action.',
      correctAnswer: true,
      explanation: 'Yes, past perfect indicates the earlier of two past actions.',
      points: 10,
    },
    {
      id: 'b2-u2-l2-e7',
      type: 'fill-blank',
      instruction: 'Complete the sentence with the correct form',
      question: 'The movie ___ (start) when we arrived at the cinema.',
      correctAnswer: 'had started',
      explanation: 'The movie started before our arrival, so use past perfect.',
      points: 10,
    },
    {
      id: 'b2-u2-l2-e8',
      type: 'multiple-choice',
      instruction: 'Select the correct answer',
      question: 'Which action happened first? "He realized he ___ his keys at home."',
      options: ['had left', 'left', 'has left', 'was leaving'],
      correctAnswer: 0,
      explanation: 'Leaving the keys happened before realizing it.',
      points: 10,
    },
    {
      id: 'b2-u2-l2-e9',
      type: 'translation',
      instruction: 'Translate to English',
      question: 'Cuando llegué, ella ya había salido.',
      correctAnswer: 'When I arrived, she had already left',
      acceptableAnswers: ['When I arrived, she had already left.'],
      explanation: '"Ya había salido" = "had already left" (past perfect).',
      points: 10,
    },
    {
      id: 'b2-u2-l2-e10',
      type: 'error-correction',
      instruction: 'Find and correct the error',
      sentence: 'By the time we got there, the show started.',
      correctAnswer: 'By the time we got there, the show had started.',
      explanation: 'Use past perfect "had started" for the earlier action.',
      points: 10,
    },
  ],
};

// ============================================
// LESSON 3: Past Perfect vs Past Simple
// ============================================
const lesson3: Lesson = {
  id: 'b2-u2-l3',
  unitId: 'b2-u2',
  title: 'Past Perfect vs Past Simple',
  description: 'Learn when to use past perfect versus past simple',
  order: 3,
  xpReward: 20,
  grammarPoint: 'Distinguishing past perfect from past simple',
  vocabularyWords: ['when', 'after', 'before', 'as soon as', 'until', 'once', 'earlier', 'later'],
  exercises: [
    {
      id: 'b2-u2-l3-e1',
      type: 'multiple-choice',
      instruction: 'Select the correct answer',
      question: 'I went to bed after I ___ my homework.',
      options: ['had finished', 'finished', 'have finished', 'was finishing'],
      correctAnswer: 0,
      explanation: 'Use past perfect after "after" to show the earlier action.',
      points: 10,
    },
    {
      id: 'b2-u2-l3-e2',
      type: 'fill-blank',
      instruction: 'Complete with past simple or past perfect',
      question: 'She ___ (leave) before he ___ (arrive).',
      correctAnswer: 'had left, arrived',
      acceptableAnswers: ['left, arrived'],
      explanation: 'First action (leaving) uses past perfect; second uses past simple.',
      points: 10,
    },
    {
      id: 'b2-u2-l3-e3',
      type: 'matching',
      instruction: 'Match the sentence with the correct tense explanation',
      pairs: [
        { left: 'I had eaten before you arrived', right: 'Earlier action: past perfect' },
        { left: 'I ate and then I left', right: 'Sequential actions: both past simple' },
        { left: 'After I had studied, I slept', right: 'Earlier action marked with "after"' },
        { left: 'When I called, she left', right: 'Two actions at same time: past simple' },
      ],
      explanation: 'Past perfect emphasizes which action happened first.',
      points: 10,
    },
    {
      id: 'b2-u2-l3-e4',
      type: 'multiple-choice',
      instruction: 'Choose the correct form',
      question: '"Before he ___ to bed, he ___ all the lights."',
      options: ['went, had turned off', 'had gone, turned off', 'went, turned off', 'has gone, turned off'],
      correctAnswer: 0,
      explanation: '"Before" introduces later action (past simple), earlier action uses past perfect.',
      points: 10,
    },
    {
      id: 'b2-u2-l3-e5',
      type: 'word-order',
      instruction: 'Put the words in the correct order',
      words: ['already', 'started', 'arrived', 'The', 'meeting', 'had', 'when', 'I'],
      correctOrder: [3, 4, 5, 6, 1, 7, 2, 0],
      explanation: 'Past perfect (had started) for earlier action, past simple for later.',
      points: 10,
    },
    {
      id: 'b2-u2-l3-e6',
      type: 'true-false',
      instruction: 'Is this statement correct?',
      statement: 'We can use two past simple verbs if the order is clear from context.',
      correctAnswer: true,
      explanation: 'Yes, with clear sequence words like "first, then", past simple is fine.',
      points: 10,
    },
    {
      id: 'b2-u2-l3-e7',
      type: 'fill-blank',
      instruction: 'Complete the sentence with the correct form',
      question: 'After they ___ (finish) dinner, they ___ (watch) a movie.',
      correctAnswer: 'had finished, watched',
      acceptableAnswers: ['finished, watched'],
      explanation: '"After" can take past perfect for earlier action, past simple for later.',
      points: 10,
    },
    {
      id: 'b2-u2-l3-e8',
      type: 'multiple-choice',
      instruction: 'Select the correct answer',
      question: 'Which sentence shows the concert started before Tom arrived?',
      options: ['The concert had started when Tom arrived', 'The concert started when Tom arrived', 'The concert has started when Tom arrived', 'The concert was starting when Tom arrived'],
      correctAnswer: 0,
      explanation: 'Past perfect "had started" shows it began before Tom\'s arrival.',
      points: 10,
    },
    {
      id: 'b2-u2-l3-e9',
      type: 'translation',
      instruction: 'Translate to English',
      question: 'Después de que habíamos comido, fuimos al cine.',
      correctAnswer: 'After we had eaten, we went to the cinema',
      acceptableAnswers: ['After we had eaten, we went to the cinema.', 'After we had eaten, we went to the movies', 'After we had eaten, we went to the movies.'],
      explanation: '"Habíamos comido" = "had eaten" (past perfect).',
      points: 10,
    },
    {
      id: 'b2-u2-l3-e10',
      type: 'error-correction',
      instruction: 'Find and correct the error',
      sentence: 'When I got home, I realized I forgot my keys at work.',
      correctAnswer: 'When I got home, I realized I had forgotten my keys at work.',
      explanation: 'Forgetting happened before realizing, so use past perfect "had forgotten".',
      points: 10,
    },
  ],
};

// ============================================
// LESSON 4: Time Sequencing in Stories
// ============================================
const lesson4: Lesson = {
  id: 'b2-u2-l4',
  unitId: 'b2-u2',
  title: 'Time Sequencing in Stories',
  description: 'Use past perfect to clarify the order of events in narratives',
  order: 4,
  xpReward: 20,
  grammarPoint: 'Past perfect in narrative context',
  vocabularyWords: ['previously', 'earlier', 'prior to', 'beforehand', 'already', 'by then', 'until then', 'up to that point'],
  exercises: [
    {
      id: 'b2-u2-l4-e1',
      type: 'multiple-choice',
      instruction: 'Select the correct answer',
      question: 'She knew the city well because she ___ there for years.',
      options: ['had lived', 'lived', 'has lived', 'was living'],
      correctAnswer: 0,
      explanation: 'Living there happened before knowing it well, so use past perfect.',
      points: 10,
    },
    {
      id: 'b2-u2-l4-e2',
      type: 'fill-blank',
      instruction: 'Complete the sentence with the correct form',
      question: 'John was exhausted because he ___ (not sleep) well for days.',
      correctAnswer: 'had not slept',
      acceptableAnswers: ['hadn\'t slept'],
      explanation: 'The lack of sleep preceded being exhausted.',
      points: 10,
    },
    {
      id: 'b2-u2-l4-e3',
      type: 'matching',
      instruction: 'Match the story element with its tense',
      pairs: [
        { left: 'Background event (earlier)', right: 'Past perfect' },
        { left: 'Main story event', right: 'Past simple' },
        { left: 'Setting the scene', right: 'Past simple / continuous' },
        { left: 'Event before main story', right: 'Past perfect' },
      ],
      explanation: 'Past perfect provides background for past simple main events.',
      points: 10,
    },
    {
      id: 'b2-u2-l4-e4',
      type: 'multiple-choice',
      instruction: 'Choose the correct form',
      question: '"The house looked beautiful. Someone ___ it recently."',
      options: ['had painted', 'painted', 'has painted', 'was painting'],
      correctAnswer: 0,
      explanation: 'The painting happened before the observation.',
      points: 10,
    },
    {
      id: 'b2-u2-l4-e5',
      type: 'word-order',
      instruction: 'Put the words in the correct order',
      words: ['studied', 'never', 'had', 'He', 'English', 'before'],
      correctOrder: [3, 2, 1, 0, 4, 5],
      explanation: 'Subject + had + never + past participle + before.',
      points: 10,
    },
    {
      id: 'b2-u2-l4-e6',
      type: 'true-false',
      instruction: 'Is this statement correct?',
      statement: 'Past perfect helps establish background information in stories.',
      correctAnswer: true,
      explanation: 'Yes, it shows what happened before the main story events.',
      points: 10,
    },
    {
      id: 'b2-u2-l4-e7',
      type: 'fill-blank',
      instruction: 'Complete the sentence with the correct form',
      question: 'She recognized him immediately. They ___ (meet) several times before.',
      correctAnswer: 'had met',
      explanation: 'Meeting happened before recognizing, so use past perfect.',
      points: 10,
    },
    {
      id: 'b2-u2-l4-e8',
      type: 'multiple-choice',
      instruction: 'Select the correct answer',
      question: 'The children were excited because they ___ to Disneyland before.',
      options: ['had never been', 'have never been', 'never were', 'were never'],
      correctAnswer: 0,
      explanation: 'Their lack of prior experience uses past perfect negative.',
      points: 10,
    },
    {
      id: 'b2-u2-l4-e9',
      type: 'translation',
      instruction: 'Translate to English',
      question: 'Él estaba nervioso porque nunca había dado una presentación antes.',
      correctAnswer: 'He was nervous because he had never given a presentation before',
      acceptableAnswers: ['He was nervous because he had never given a presentation before.'],
      explanation: '"Nunca había dado" = "had never given" (past perfect).',
      points: 10,
    },
    {
      id: 'b2-u2-l4-e10',
      type: 'error-correction',
      instruction: 'Find and correct the error',
      sentence: 'The restaurant was empty. Everyone left already.',
      correctAnswer: 'The restaurant was empty. Everyone had left already.',
      explanation: 'Leaving happened before the observation, so use past perfect "had left".',
      points: 10,
    },
  ],
};

// ============================================
// LESSON 5: Already, Just, Never with Past Perfect
// ============================================
const lesson5: Lesson = {
  id: 'b2-u2-l5',
  unitId: 'b2-u2',
  title: 'Already, Just, Never with Past Perfect',
  description: 'Use time adverbs with past perfect tense',
  order: 5,
  xpReward: 20,
  grammarPoint: 'Past perfect with already, just, never',
  vocabularyWords: ['already', 'just', 'never', 'ever', 'yet', 'still', 'recently', 'lately'],
  exercises: [
    {
      id: 'b2-u2-l5-e1',
      type: 'multiple-choice',
      instruction: 'Select the correct answer',
      question: 'When I arrived, they ___ started the meeting.',
      options: ['had just', 'have just', 'just', 'were just'],
      correctAnswer: 0,
      explanation: '"Had just" shows the action happened shortly before another past action.',
      points: 10,
    },
    {
      id: 'b2-u2-l5-e2',
      type: 'fill-blank',
      instruction: 'Complete the sentence with the correct form',
      question: 'I wasn\'t hungry because I ___ already ___ (eat).',
      correctAnswer: 'had, eaten',
      explanation: '"Had already eaten" shows completion before another past time.',
      points: 10,
    },
    {
      id: 'b2-u2-l5-e3',
      type: 'matching',
      instruction: 'Match the adverb with its meaning',
      pairs: [
        { left: 'Already', right: 'Before expected time' },
        { left: 'Just', right: 'Very recently' },
        { left: 'Never', right: 'Not at any time before' },
        { left: 'Yet', right: 'Expected but not happened' },
      ],
      explanation: 'These adverbs modify the meaning of past perfect.',
      points: 10,
    },
    {
      id: 'b2-u2-l5-e4',
      type: 'multiple-choice',
      instruction: 'Choose the correct form',
      question: '"He ___ seen such a beautiful sunset."',
      options: ['had never', 'has never', 'never has', 'never had'],
      correctAnswer: 0,
      explanation: '"Had never" shows this was a first experience up to that past point.',
      points: 10,
    },
    {
      id: 'b2-u2-l5-e5',
      type: 'word-order',
      instruction: 'Put the words in the correct order',
      words: ['finished', 'already', 'She', 'homework', 'her', 'had'],
      correctOrder: [2, 5, 1, 0, 3, 4],
      explanation: '"Already" goes between "had" and the past participle.',
      points: 10,
    },
    {
      id: 'b2-u2-l5-e6',
      type: 'true-false',
      instruction: 'Is this statement correct?',
      statement: '"Just" in past perfect means something happened very recently before another past action.',
      correctAnswer: true,
      explanation: 'Yes, "had just" indicates immediate precedence.',
      points: 10,
    },
    {
      id: 'b2-u2-l5-e7',
      type: 'fill-blank',
      instruction: 'Complete the sentence with the correct form',
      question: 'They were disappointed because the movie ___ already ___ (start).',
      correctAnswer: 'had, started',
      explanation: '"Had already started" shows it began before their arrival.',
      points: 10,
    },
    {
      id: 'b2-u2-l5-e8',
      type: 'multiple-choice',
      instruction: 'Select the correct answer',
      question: 'Where does "never" go in past perfect?',
      options: ['Between had and past participle', 'Before had', 'After past participle', 'At the end'],
      correctAnswer: 0,
      explanation: '"Never" goes between "had" and the past participle: had never seen.',
      points: 10,
    },
    {
      id: 'b2-u2-l5-e9',
      type: 'translation',
      instruction: 'Translate to English',
      question: 'Ella acababa de salir cuando tú llamaste.',
      correctAnswer: 'She had just left when you called',
      acceptableAnswers: ['She had just left when you called.'],
      explanation: '"Acababa de" = "had just" (past perfect).',
      points: 10,
    },
    {
      id: 'b2-u2-l5-e10',
      type: 'error-correction',
      instruction: 'Find and correct the error',
      sentence: 'I have already finished when she arrived.',
      correctAnswer: 'I had already finished when she arrived.',
      explanation: 'Use past perfect "had already finished" with past time reference.',
      points: 10,
    },
  ],
};

// ============================================
// LESSON 6: After, Before, When Clauses
// ============================================
const lesson6: Lesson = {
  id: 'b2-u2-l6',
  unitId: 'b2-u2',
  title: 'After, Before, When Clauses',
  description: 'Use past perfect with time clauses',
  order: 6,
  xpReward: 20,
  grammarPoint: 'Past perfect with after, before, when',
  vocabularyWords: ['after', 'before', 'when', 'as soon as', 'once', 'until', 'while', 'since'],
  exercises: [
    {
      id: 'b2-u2-l6-e1',
      type: 'multiple-choice',
      instruction: 'Select the correct answer',
      question: 'After I ___ my homework, I went out.',
      options: ['had finished', 'finished', 'have finished', 'was finishing'],
      correctAnswer: 0,
      explanation: 'After + past perfect emphasizes the earlier action was complete.',
      points: 10,
    },
    {
      id: 'b2-u2-l6-e2',
      type: 'fill-blank',
      instruction: 'Complete the sentence with the correct form',
      question: 'Before she ___ (move) to London, she ___ (live) in Paris.',
      correctAnswer: 'moved, had lived',
      explanation: 'Before + past simple, subject + had + past participle.',
      points: 10,
    },
    {
      id: 'b2-u2-l6-e3',
      type: 'matching',
      instruction: 'Match the time word with its usage',
      pairs: [
        { left: 'After + past perfect', right: 'Earlier action complete' },
        { left: 'Before + past simple', right: 'Later action' },
        { left: 'When + past simple', right: 'Two actions, one after another' },
        { left: 'As soon as + past perfect', right: 'Immediate sequence' },
      ],
      explanation: 'Different time words show different relationships between actions.',
      points: 10,
    },
    {
      id: 'b2-u2-l6-e4',
      type: 'multiple-choice',
      instruction: 'Choose the correct form',
      question: '"When I called her, she ___ dinner."',
      options: ['had already cooked', 'already cooked', 'has already cooked', 'cooks already'],
      correctAnswer: 0,
      explanation: 'Cooking was complete before the call, so use past perfect.',
      points: 10,
    },
    {
      id: 'b2-u2-l6-e5',
      type: 'word-order',
      instruction: 'Put the words in the correct order',
      words: ['had', 'Once', 'the', 'read', 'she', 'book'],
      correctOrder: [1, 4, 0, 3, 2, 5],
      explanation: 'Once + subject + had + past participle.',
      points: 10,
    },
    {
      id: 'b2-u2-l6-e6',
      type: 'true-false',
      instruction: 'Is this statement correct?',
      statement: 'We use past perfect after "before" to show which action happened first.',
      correctAnswer: false,
      explanation: 'Actually, "before" already shows order, so past simple is often enough, though past perfect can be used for emphasis.',
      points: 10,
    },
    {
      id: 'b2-u2-l6-e7',
      type: 'fill-blank',
      instruction: 'Complete the sentence with the correct form',
      question: 'As soon as they ___ (arrive), the party started.',
      correctAnswer: 'had arrived',
      acceptableAnswers: ['arrived'],
      explanation: '"As soon as" can take past perfect to emphasize completion.',
      points: 10,
    },
    {
      id: 'b2-u2-l6-e8',
      type: 'multiple-choice',
      instruction: 'Select the correct answer',
      question: 'Which is correct for emphasis on completion?',
      options: ['After I had eaten, I left', 'After I ate, I left', 'Both are correct', 'Neither is correct'],
      correctAnswer: 2,
      explanation: 'Both are correct, but past perfect emphasizes completion more strongly.',
      points: 10,
    },
    {
      id: 'b2-u2-l6-e9',
      type: 'translation',
      instruction: 'Translate to English',
      question: 'Antes de que él llegara, yo ya había terminado.',
      correctAnswer: 'Before he arrived, I had already finished',
      acceptableAnswers: ['Before he arrived, I had already finished.'],
      explanation: '"Ya había terminado" = "had already finished".',
      points: 10,
    },
    {
      id: 'b2-u2-l6-e10',
      type: 'error-correction',
      instruction: 'Find and correct the error',
      sentence: 'After we have dinner, we watched a movie last night.',
      correctAnswer: 'After we had had dinner, we watched a movie last night.',
      explanation: 'Use past perfect "had had" after "after" with past time reference.',
      points: 10,
    },
  ],
};

// ============================================
// LESSON 7: By the Time Expressions
// ============================================
const lesson7: Lesson = {
  id: 'b2-u2-l7',
  unitId: 'b2-u2',
  title: 'By the Time Expressions',
  description: 'Use past perfect with "by the time" constructions',
  order: 7,
  xpReward: 20,
  grammarPoint: 'By the time + past perfect',
  vocabularyWords: ['by the time', 'by then', 'by that point', 'by that time', 'up until', 'up to that moment', 'by', 'until'],
  exercises: [
    {
      id: 'b2-u2-l7-e1',
      type: 'multiple-choice',
      instruction: 'Select the correct answer',
      question: 'By the time we arrived, the show ___.',
      options: ['had ended', 'ended', 'has ended', 'was ending'],
      correctAnswer: 0,
      explanation: '"By the time" + past simple, past perfect shows earlier completion.',
      points: 10,
    },
    {
      id: 'b2-u2-l7-e2',
      type: 'fill-blank',
      instruction: 'Complete the sentence with the correct form',
      question: 'By the time I got to the station, the train ___ (leave).',
      correctAnswer: 'had left',
      explanation: '"By the time" requires past perfect for the earlier action.',
      points: 10,
    },
    {
      id: 'b2-u2-l7-e3',
      type: 'matching',
      instruction: 'Match the expression with its meaning',
      pairs: [
        { left: 'By the time', right: 'Before the moment when' },
        { left: 'By then', right: 'Before that moment' },
        { left: 'Up until then', right: 'Continuing up to that point' },
        { left: 'By that point', right: 'Before reaching that stage' },
      ],
      explanation: 'These expressions all indicate completion before a past reference point.',
      points: 10,
    },
    {
      id: 'b2-u2-l7-e4',
      type: 'multiple-choice',
      instruction: 'Choose the correct form',
      question: '"By 2010, she ___ three books."',
      options: ['had written', 'wrote', 'has written', 'was writing'],
      correctAnswer: 0,
      explanation: '"By + past year" uses past perfect to show completion before that time.',
      points: 10,
    },
    {
      id: 'b2-u2-l7-e5',
      type: 'word-order',
      instruction: 'Put the words in the correct order',
      words: ['time', 'By', 'arrived', 'the', 'everyone', 'had', 'he'],
      correctOrder: [1, 0, 3, 6, 5, 2, 4],
      explanation: 'By the time + subject + past simple, subject + had + past participle.',
      points: 10,
    },
    {
      id: 'b2-u2-l7-e6',
      type: 'true-false',
      instruction: 'Is this statement correct?',
      statement: '"By the time" is always followed by past perfect.',
      correctAnswer: false,
      explanation: '"By the time" is followed by past simple; the main clause uses past perfect.',
      points: 10,
    },
    {
      id: 'b2-u2-l7-e7',
      type: 'fill-blank',
      instruction: 'Complete the sentence with the correct form',
      question: 'By then, we ___ (already/find) a solution.',
      correctAnswer: 'had already found',
      explanation: '"By then" requires past perfect with "already".',
      points: 10,
    },
    {
      id: 'b2-u2-l7-e8',
      type: 'multiple-choice',
      instruction: 'Select the correct answer',
      question: 'By the time the doctor arrived, the patient ___.',
      options: ['had already recovered', 'already recovered', 'has already recovered', 'recovers already'],
      correctAnswer: 0,
      explanation: 'Recovery happened before the doctor\'s arrival.',
      points: 10,
    },
    {
      id: 'b2-u2-l7-e9',
      type: 'translation',
      instruction: 'Translate to English',
      question: 'Para cuando terminó la película, yo ya me había dormido.',
      correctAnswer: 'By the time the movie ended, I had already fallen asleep',
      acceptableAnswers: ['By the time the movie ended, I had already fallen asleep.'],
      explanation: '"Para cuando" = "By the time"; "ya me había dormido" = "had already fallen asleep".',
      points: 10,
    },
    {
      id: 'b2-u2-l7-e10',
      type: 'error-correction',
      instruction: 'Find and correct the error',
      sentence: 'By the time I have arrived, they left.',
      correctAnswer: 'By the time I arrived, they had left.',
      explanation: 'Use past simple "arrived" after "by the time", and past perfect "had left" in main clause.',
      points: 10,
    },
  ],
};

// ============================================
// LESSON 8: Reported Speech with Past Perfect
// ============================================
const lesson8: Lesson = {
  id: 'b2-u2-l8',
  unitId: 'b2-u2',
  title: 'Reported Speech with Past Perfect',
  description: 'Use past perfect when reporting past statements',
  order: 8,
  xpReward: 20,
  grammarPoint: 'Past perfect in reported speech',
  vocabularyWords: ['said', 'told', 'explained', 'mentioned', 'admitted', 'claimed', 'reported', 'announced'],
  exercises: [
    {
      id: 'b2-u2-l8-e1',
      type: 'multiple-choice',
      instruction: 'Select the correct answer',
      question: 'He said, "I finished my work." → He said he ___ his work.',
      options: ['had finished', 'finished', 'has finished', 'finishes'],
      correctAnswer: 0,
      explanation: 'Past simple in direct speech becomes past perfect in reported speech.',
      points: 10,
    },
    {
      id: 'b2-u2-l8-e2',
      type: 'fill-blank',
      instruction: 'Complete the sentence with the correct form',
      question: 'She told me she ___ (see) that movie before.',
      correctAnswer: 'had seen',
      explanation: 'Reported speech: past simple → past perfect.',
      points: 10,
    },
    {
      id: 'b2-u2-l8-e3',
      type: 'matching',
      instruction: 'Match direct speech with reported speech',
      pairs: [
        { left: '"I ate lunch"', right: 'He said he had eaten lunch' },
        { left: '"I have finished"', right: 'She said she had finished' },
        { left: '"I went home"', right: 'He told me he had gone home' },
        { left: '"I studied hard"', right: 'She said she had studied hard' },
      ],
      explanation: 'Past tenses in direct speech shift to past perfect in reported speech.',
      points: 10,
    },
    {
      id: 'b2-u2-l8-e4',
      type: 'multiple-choice',
      instruction: 'Choose the correct form',
      question: 'They explained that they ___ the instructions.',
      options: ['had followed', 'followed', 'have followed', 'follow'],
      correctAnswer: 0,
      explanation: 'Use past perfect in reported speech after past reporting verb.',
      points: 10,
    },
    {
      id: 'b2-u2-l8-e5',
      type: 'word-order',
      instruction: 'Put the words in the correct order',
      words: ['told', 'had', 'already', 'me', 'He', 'left', 'she'],
      correctOrder: [4, 0, 3, 6, 1, 2, 5],
      explanation: 'He told me (that) she had already left.',
      points: 10,
    },
    {
      id: 'b2-u2-l8-e6',
      type: 'true-false',
      instruction: 'Is this statement correct?',
      statement: 'Present perfect in direct speech becomes past perfect in reported speech.',
      correctAnswer: true,
      explanation: 'Yes, "have done" → "had done" when reporting.',
      points: 10,
    },
    {
      id: 'b2-u2-l8-e7',
      type: 'fill-blank',
      instruction: 'Complete the sentence with the correct form',
      question: 'He admitted that he ___ (make) a mistake.',
      correctAnswer: 'had made',
      explanation: 'Reported speech with past reporting verb uses past perfect.',
      points: 10,
    },
    {
      id: 'b2-u2-l8-e8',
      type: 'multiple-choice',
      instruction: 'Select the correct answer',
      question: 'She said, "I have never been to Japan." → She said she ___ to Japan.',
      options: ['had never been', 'has never been', 'never was', 'was never'],
      correctAnswer: 0,
      explanation: 'Present perfect "have never been" → past perfect "had never been".',
      points: 10,
    },
    {
      id: 'b2-u2-l8-e9',
      type: 'translation',
      instruction: 'Translate to English',
      question: 'Él dijo que había terminado el proyecto.',
      correctAnswer: 'He said he had finished the project',
      acceptableAnswers: ['He said he had finished the project.', 'He said that he had finished the project', 'He said that he had finished the project.'],
      explanation: '"Había terminado" in reported speech = "had finished".',
      points: 10,
    },
    {
      id: 'b2-u2-l8-e10',
      type: 'error-correction',
      instruction: 'Find and correct the error',
      sentence: 'She told me that she has already left when I called.',
      correctAnswer: 'She told me that she had already left when I called.',
      explanation: 'Use past perfect "had already left" in reported speech after past reporting verb.',
      points: 10,
    },
  ],
};

// ============================================
// LESSON 9: Unfulfilled Past Expectations
// ============================================
const lesson9: Lesson = {
  id: 'b2-u2-l9',
  unitId: 'b2-u2',
  title: 'Unfulfilled Past Expectations',
  description: 'Express things that didn\'t happen as expected in the past',
  order: 9,
  xpReward: 20,
  grammarPoint: 'Past perfect for unrealized plans',
  vocabularyWords: ['hoped', 'expected', 'planned', 'intended', 'wanted', 'thought', 'assumed', 'believed'],
  exercises: [
    {
      id: 'b2-u2-l9-e1',
      type: 'multiple-choice',
      instruction: 'Select the correct answer',
      question: 'I had hoped to see you, but you ___ already ___.',
      options: ['had, left', 'have, left', 'has, left', 'did, leave'],
      correctAnswer: 0,
      explanation: 'Past perfect expresses an unfulfilled hope about the past.',
      points: 10,
    },
    {
      id: 'b2-u2-l9-e2',
      type: 'fill-blank',
      instruction: 'Complete the sentence with the correct form',
      question: 'She had expected that he ___ (come) to the party.',
      correctAnswer: 'would come',
      acceptableAnswers: ['had come'],
      explanation: 'After "had expected", use "would" or past perfect.',
      points: 10,
    },
    {
      id: 'b2-u2-l9-e3',
      type: 'matching',
      instruction: 'Match the expression with its meaning',
      pairs: [
        { left: 'Had hoped to do', right: 'Wanted but didn\'t happen' },
        { left: 'Had planned to do', right: 'Intended but didn\'t happen' },
        { left: 'Had expected that', right: 'Thought would happen but didn\'t' },
        { left: 'Had intended to do', right: 'Meant to do but didn\'t' },
      ],
      explanation: 'Past perfect with these verbs expresses unrealized past intentions.',
      points: 10,
    },
    {
      id: 'b2-u2-l9-e4',
      type: 'multiple-choice',
      instruction: 'Choose the correct form',
      question: '"They had planned ___ early, but they overslept."',
      options: ['to leave', 'leaving', 'leave', 'left'],
      correctAnswer: 0,
      explanation: '"Had planned" is followed by infinitive "to" + base verb.',
      points: 10,
    },
    {
      id: 'b2-u2-l9-e5',
      type: 'word-order',
      instruction: 'Put the words in the correct order',
      words: ['to', 'had', 'call', 'I', 'you', 'intended'],
      correctOrder: [3, 1, 5, 0, 2, 4],
      explanation: 'Subject + had intended + to + base verb + object.',
      points: 10,
    },
    {
      id: 'b2-u2-l9-e6',
      type: 'true-false',
      instruction: 'Is this statement correct?',
      statement: '"Had hoped to" expresses something that didn\'t happen.',
      correctAnswer: true,
      explanation: 'Yes, it shows an unfulfilled hope or expectation.',
      points: 10,
    },
    {
      id: 'b2-u2-l9-e7',
      type: 'fill-blank',
      instruction: 'Complete the sentence with the correct form',
      question: 'We had wanted ___ (visit) Paris, but we didn\'t have time.',
      correctAnswer: 'to visit',
      explanation: '"Had wanted" is followed by infinitive "to visit".',
      points: 10,
    },
    {
      id: 'b2-u2-l9-e8',
      type: 'multiple-choice',
      instruction: 'Select the correct answer',
      question: 'He had thought that she ___ understand.',
      options: ['would', 'will', 'can', 'could'],
      correctAnswer: 0,
      explanation: 'After "had thought", use "would" for past expectation about the future.',
      points: 10,
    },
    {
      id: 'b2-u2-l9-e9',
      type: 'translation',
      instruction: 'Translate to English',
      question: 'Yo había esperado verte en la fiesta.',
      correctAnswer: 'I had hoped to see you at the party',
      acceptableAnswers: ['I had hoped to see you at the party.'],
      explanation: '"Había esperado" = "had hoped" (unfulfilled expectation).',
      points: 10,
    },
    {
      id: 'b2-u2-l9-e10',
      type: 'error-correction',
      instruction: 'Find and correct the error',
      sentence: 'She has planned to go, but she got sick.',
      correctAnswer: 'She had planned to go, but she got sick.',
      explanation: 'Use past perfect "had planned" for unfulfilled past plan.',
      points: 10,
    },
  ],
};

// ============================================
// LESSON 10: Third Conditional Review
// ============================================
const lesson10: Lesson = {
  id: 'b2-u2-l10',
  unitId: 'b2-u2',
  title: 'Third Conditional Review',
  description: 'Brief review of past perfect in third conditional',
  order: 10,
  xpReward: 20,
  grammarPoint: 'If + past perfect, would have + past participle',
  vocabularyWords: ['if', 'would have', 'could have', 'might have', 'should have', 'wouldn\'t have', 'hadn\'t', 'regret'],
  exercises: [
    {
      id: 'b2-u2-l10-e1',
      type: 'multiple-choice',
      instruction: 'Select the correct answer',
      question: 'If I ___ harder, I would have passed the exam.',
      options: ['had studied', 'studied', 'have studied', 'study'],
      correctAnswer: 0,
      explanation: 'Third conditional: If + past perfect, would have + past participle.',
      points: 10,
    },
    {
      id: 'b2-u2-l10-e2',
      type: 'fill-blank',
      instruction: 'Complete the sentence with the correct form',
      question: 'If she ___ (leave) earlier, she wouldn\'t have missed the train.',
      correctAnswer: 'had left',
      explanation: 'Third conditional uses past perfect in the if-clause.',
      points: 10,
    },
    {
      id: 'b2-u2-l10-e3',
      type: 'matching',
      instruction: 'Match the condition with the result',
      pairs: [
        { left: 'If I had known', right: 'I would have helped' },
        { left: 'If we had arrived earlier', right: 'We could have seen the show' },
        { left: 'If he had studied', right: 'He might have passed' },
        { left: 'If they had called', right: 'We would have come' },
      ],
      explanation: 'Third conditional expresses unreal past situations.',
      points: 10,
    },
    {
      id: 'b2-u2-l10-e4',
      type: 'multiple-choice',
      instruction: 'Choose the correct form',
      question: '"They ___ if they had known about the problem."',
      options: ['would have helped', 'will help', 'helped', 'help'],
      correctAnswer: 0,
      explanation: 'Third conditional result clause: would have + past participle.',
      points: 10,
    },
    {
      id: 'b2-u2-l10-e5',
      type: 'word-order',
      instruction: 'Put the words in the correct order',
      words: ['known', 'If', 'had', 'I', 'told', 'have', 'would', 'you', 'I'],
      correctOrder: [1, 8, 2, 3, 8, 6, 4, 7],
      explanation: 'If + subject + had + past participle, subject + would have + past participle.',
      points: 10,
    },
    {
      id: 'b2-u2-l10-e6',
      type: 'true-false',
      instruction: 'Is this statement correct?',
      statement: 'Third conditional talks about imaginary past situations.',
      correctAnswer: true,
      explanation: 'Yes, it expresses unreal conditions and results in the past.',
      points: 10,
    },
    {
      id: 'b2-u2-l10-e7',
      type: 'fill-blank',
      instruction: 'Complete the sentence with the correct form',
      question: 'If we ___ (not miss) the bus, we ___ (arrive) on time.',
      correctAnswer: 'hadn\'t missed, would have arrived',
      explanation: 'Negative past perfect in if-clause, would have + past participle in result.',
      points: 10,
    },
    {
      id: 'b2-u2-l10-e8',
      type: 'multiple-choice',
      instruction: 'Select the correct answer',
      question: 'Which modal can we use in third conditional result clauses?',
      options: ['All: would have, could have, might have', 'Only would have', 'Only could have', 'Only might have'],
      correctAnswer: 0,
      explanation: 'We can use would/could/might have in third conditional results.',
      points: 10,
    },
    {
      id: 'b2-u2-l10-e9',
      type: 'translation',
      instruction: 'Translate to English',
      question: 'Si hubiera sabido, te habría ayudado.',
      correctAnswer: 'If I had known, I would have helped you',
      acceptableAnswers: ['If I had known, I would have helped you.'],
      explanation: '"Si hubiera sabido" = "If I had known"; "te habría ayudado" = "I would have helped you".',
      points: 10,
    },
    {
      id: 'b2-u2-l10-e10',
      type: 'error-correction',
      instruction: 'Find and correct the error',
      sentence: 'If I would have known, I would have told you.',
      correctAnswer: 'If I had known, I would have told you.',
      explanation: 'Use past perfect "had known" in if-clause, not "would have known".',
      points: 10,
    },
  ],
};

// ============================================
// LESSON 11: Because Clauses with Past Perfect
// ============================================
const lesson11: Lesson = {
  id: 'b2-u2-l11',
  unitId: 'b2-u2',
  title: 'Because Clauses with Past Perfect',
  description: 'Explain reasons using past perfect',
  order: 11,
  xpReward: 20,
  grammarPoint: 'Because + past perfect for earlier causes',
  vocabularyWords: ['because', 'since', 'as', 'due to', 'owing to', 'thanks to', 'reason', 'cause'],
  exercises: [
    {
      id: 'b2-u2-l11-e1',
      type: 'multiple-choice',
      instruction: 'Select the correct answer',
      question: 'She was tired because she ___ all night.',
      options: ['had worked', 'worked', 'has worked', 'works'],
      correctAnswer: 0,
      explanation: 'Working happened before being tired, so use past perfect.',
      points: 10,
    },
    {
      id: 'b2-u2-l11-e2',
      type: 'fill-blank',
      instruction: 'Complete the sentence with the correct form',
      question: 'He was angry because someone ___ (steal) his bike.',
      correctAnswer: 'had stolen',
      explanation: 'The theft happened before his anger, so use past perfect.',
      points: 10,
    },
    {
      id: 'b2-u2-l11-e3',
      type: 'matching',
      instruction: 'Match the result with its cause',
      pairs: [
        { left: 'She was happy', right: 'Because she had passed the exam' },
        { left: 'He was late', right: 'Because he had missed the bus' },
        { left: 'They were excited', right: 'Because they had won the lottery' },
        { left: 'I was disappointed', right: 'Because I had failed the test' },
      ],
      explanation: 'Past perfect shows the earlier cause of a past result.',
      points: 10,
    },
    {
      id: 'b2-u2-l11-e4',
      type: 'multiple-choice',
      instruction: 'Choose the correct form',
      question: '"Since he ___ his homework, he could go out."',
      options: ['had finished', 'finished', 'has finished', 'finishes'],
      correctAnswer: 0,
      explanation: '"Since" (meaning because) takes past perfect for earlier action.',
      points: 10,
    },
    {
      id: 'b2-u2-l11-e5',
      type: 'word-order',
      instruction: 'Put the words in the correct order',
      words: ['because', 'was', 'she', 'She', 'happy', 'succeeded', 'had'],
      correctOrder: [3, 1, 4, 0, 2, 6, 5],
      explanation: 'Subject + was + adjective + because + subject + had + past participle.',
      points: 10,
    },
    {
      id: 'b2-u2-l11-e6',
      type: 'true-false',
      instruction: 'Is this statement correct?',
      statement: 'We use past perfect after "because" to show the earlier cause.',
      correctAnswer: true,
      explanation: 'Yes, past perfect shows what caused a past result.',
      points: 10,
    },
    {
      id: 'b2-u2-l11-e7',
      type: 'fill-blank',
      instruction: 'Complete the sentence with the correct form',
      question: 'As he ___ (not eat) breakfast, he was very hungry.',
      correctAnswer: 'had not eaten',
      acceptableAnswers: ['hadn\'t eaten'],
      explanation: '"As" (meaning because) uses past perfect for earlier action.',
      points: 10,
    },
    {
      id: 'b2-u2-l11-e8',
      type: 'multiple-choice',
      instruction: 'Select the correct answer',
      question: 'They couldn\'t enter because they ___ their tickets.',
      options: ['had forgotten', 'forgot', 'have forgotten', 'forget'],
      correctAnswer: 0,
      explanation: 'Forgetting happened before being unable to enter.',
      points: 10,
    },
    {
      id: 'b2-u2-l11-e9',
      type: 'translation',
      instruction: 'Translate to English',
      question: 'Estaba cansado porque había corrido 10 kilómetros.',
      correctAnswer: 'I was tired because I had run 10 kilometers',
      acceptableAnswers: ['I was tired because I had run 10 kilometers.', 'I was tired because I had run 10 kilometres', 'I was tired because I had run 10 kilometres.'],
      explanation: '"Había corrido" = "had run" (past perfect showing earlier cause).',
      points: 10,
    },
    {
      id: 'b2-u2-l11-e10',
      type: 'error-correction',
      instruction: 'Find and correct the error',
      sentence: 'She was upset because her friend didn\'t call her.',
      correctAnswer: 'She was upset because her friend hadn\'t called her.',
      explanation: 'Use past perfect "hadn\'t called" for the earlier cause of being upset.',
      points: 10,
    },
  ],
};

// ============================================
// LESSON 12: Questions and Negatives
// ============================================
const lesson12: Lesson = {
  id: 'b2-u2-l12',
  unitId: 'b2-u2',
  title: 'Questions and Negatives',
  description: 'Form questions and negatives with past perfect',
  order: 12,
  xpReward: 20,
  grammarPoint: 'Had + subject + past participle? / hadn\'t + past participle',
  vocabularyWords: ['had', 'hadn\'t', 'had not', 'ever', 'never', 'why', 'where', 'when', 'how'],
  exercises: [
    {
      id: 'b2-u2-l12-e1',
      type: 'multiple-choice',
      instruction: 'Select the correct answer',
      question: '___ you ___ your homework before class?',
      options: ['Had, finished', 'Have, finished', 'Did, finish', 'Do, finish'],
      correctAnswer: 0,
      explanation: 'Past perfect question: Had + subject + past participle?',
      points: 10,
    },
    {
      id: 'b2-u2-l12-e2',
      type: 'fill-blank',
      instruction: 'Complete the sentence with the correct form',
      question: 'She ___ (not see) him before that day.',
      correctAnswer: 'had not seen',
      acceptableAnswers: ['hadn\'t seen'],
      explanation: 'Negative past perfect: had not / hadn\'t + past participle.',
      points: 10,
    },
    {
      id: 'b2-u2-l12-e3',
      type: 'matching',
      instruction: 'Match the question with its answer',
      pairs: [
        { left: 'Had you been there before?', right: 'Yes, I had / No, I hadn\'t' },
        { left: 'Why had she left?', right: 'Because she was tired' },
        { left: 'Where had they gone?', right: 'To the cinema' },
        { left: 'How long had you waited?', right: 'For two hours' },
      ],
      explanation: 'Past perfect questions can be yes/no or wh-questions.',
      points: 10,
    },
    {
      id: 'b2-u2-l12-e4',
      type: 'multiple-choice',
      instruction: 'Choose the correct form',
      question: '"___ she ever ___ to Japan before?"',
      options: ['Had, been', 'Has, been', 'Did, go', 'Does, go'],
      correctAnswer: 0,
      explanation: 'Past perfect question with "ever": Had + subject + ever + past participle?',
      points: 10,
    },
    {
      id: 'b2-u2-l12-e5',
      type: 'word-order',
      instruction: 'Put the words in the correct order',
      words: ['Why', 'left', 'they', 'had', 'early'],
      correctOrder: [0, 3, 2, 1, 4],
      explanation: 'Wh-question: Why + had + subject + past participle?',
      points: 10,
    },
    {
      id: 'b2-u2-l12-e6',
      type: 'true-false',
      instruction: 'Is this statement correct?',
      statement: 'To form past perfect questions, we invert "had" and the subject.',
      correctAnswer: true,
      explanation: 'Yes: Had + subject + past participle?',
      points: 10,
    },
    {
      id: 'b2-u2-l12-e7',
      type: 'fill-blank',
      instruction: 'Complete the sentence with the correct form',
      question: 'They ___ (not finish) their project before the deadline.',
      correctAnswer: 'had not finished',
      acceptableAnswers: ['hadn\'t finished'],
      explanation: 'Negative past perfect: hadn\'t + past participle.',
      points: 10,
    },
    {
      id: 'b2-u2-l12-e8',
      type: 'multiple-choice',
      instruction: 'Select the correct answer',
      question: 'How do you form negative past perfect?',
      options: ['had not + past participle', 'did not + past participle', 'have not + past participle', 'not had + past participle'],
      correctAnswer: 0,
      explanation: 'Negative past perfect: had not (hadn\'t) + past participle.',
      points: 10,
    },
    {
      id: 'b2-u2-l12-e9',
      type: 'translation',
      instruction: 'Translate to English',
      question: '¿Habías estado allí antes?',
      correctAnswer: 'Had you been there before?',
      acceptableAnswers: ['Had you been there before'],
      explanation: '"¿Habías estado?" = "Had you been?" (past perfect question).',
      points: 10,
    },
    {
      id: 'b2-u2-l12-e10',
      type: 'error-correction',
      instruction: 'Find and correct the error',
      sentence: 'Did you had finished your work?',
      correctAnswer: 'Had you finished your work?',
      explanation: 'Past perfect question uses "Had" not "Did": Had + subject + past participle?',
      points: 10,
    },
  ],
};

// ============================================
// LESSON 13: Common Time Markers
// ============================================
const lesson13: Lesson = {
  id: 'b2-u2-l13',
  unitId: 'b2-u2',
  title: 'Common Time Markers',
  description: 'Learn time expressions commonly used with past perfect',
  order: 13,
  xpReward: 20,
  grammarPoint: 'Time markers with past perfect',
  vocabularyWords: ['by', 'by the time', 'until', 'before', 'after', 'when', 'already', 'yet', 'just', 'never', 'ever', 'for', 'since'],
  exercises: [
    {
      id: 'b2-u2-l13-e1',
      type: 'multiple-choice',
      instruction: 'Select the correct answer',
      question: 'By 5 PM, I ___ all my work.',
      options: ['had completed', 'completed', 'have completed', 'complete'],
      correctAnswer: 0,
      explanation: '"By + time" uses past perfect to show completion before that time.',
      points: 10,
    },
    {
      id: 'b2-u2-l13-e2',
      type: 'fill-blank',
      instruction: 'Complete the sentence with the correct form',
      question: 'She had lived there ___ ten years before she moved.',
      correctAnswer: 'for',
      explanation: '"For + duration" shows how long before another past event.',
      points: 10,
    },
    {
      id: 'b2-u2-l13-e3',
      type: 'matching',
      instruction: 'Match the time marker with its use',
      pairs: [
        { left: 'By + time', right: 'Completion before specific time' },
        { left: 'For + duration', right: 'How long before past event' },
        { left: 'Until', right: 'Continuing up to a point' },
        { left: 'Already', right: 'Before expected time' },
      ],
      explanation: 'Different markers show different time relationships.',
      points: 10,
    },
    {
      id: 'b2-u2-l13-e4',
      type: 'multiple-choice',
      instruction: 'Choose the correct form',
      question: '"I had worked there ___ 2015."',
      options: ['since', 'for', 'from', 'by'],
      correctAnswer: 0,
      explanation: '"Since + specific start time" with past perfect shows duration up to a past point.',
      points: 10,
    },
    {
      id: 'b2-u2-l13-e5',
      type: 'word-order',
      instruction: 'Put the words in the correct order',
      words: ['5', 'o\'clock', 'By', 'already', 'they', 'left', 'had'],
      correctOrder: [2, 0, 1, 4, 6, 3, 5],
      explanation: 'By + time, subject + had already + past participle.',
      points: 10,
    },
    {
      id: 'b2-u2-l13-e6',
      type: 'true-false',
      instruction: 'Is this statement correct?',
      statement: '"Already" with past perfect means something happened before expected.',
      correctAnswer: true,
      explanation: 'Yes, "had already done" shows earlier-than-expected completion.',
      points: 10,
    },
    {
      id: 'b2-u2-l13-e7',
      type: 'fill-blank',
      instruction: 'Complete the sentence with the correct form',
      question: 'Until yesterday, I ___ never ___ (try) sushi.',
      correctAnswer: 'had, tried',
      explanation: '"Until + past time" uses past perfect to show state up to that point.',
      points: 10,
    },
    {
      id: 'b2-u2-l13-e8',
      type: 'multiple-choice',
      instruction: 'Select the correct answer',
      question: 'Which time marker shows duration before a past event?',
      options: ['For', 'By', 'When', 'At'],
      correctAnswer: 0,
      explanation: '"For + duration" shows how long something continued before a past point.',
      points: 10,
    },
    {
      id: 'b2-u2-l13-e9',
      type: 'translation',
      instruction: 'Translate to English',
      question: 'Para las 9, ya habían salido.',
      correctAnswer: 'By 9, they had already left',
      acceptableAnswers: ['By 9, they had already left.', 'By 9 o\'clock, they had already left', 'By 9 o\'clock, they had already left.'],
      explanation: '"Para las 9" = "By 9"; "ya habían salido" = "had already left".',
      points: 10,
    },
    {
      id: 'b2-u2-l13-e10',
      type: 'error-correction',
      instruction: 'Find and correct the error',
      sentence: 'By the time I arrived, they already left.',
      correctAnswer: 'By the time I arrived, they had already left.',
      explanation: 'Use past perfect "had already left" with "by the time".',
      points: 10,
    },
  ],
};

// ============================================
// LESSON 14: Common Mistakes
// ============================================
const lesson14: Lesson = {
  id: 'b2-u2-l14',
  unitId: 'b2-u2',
  title: 'Common Mistakes',
  description: 'Identify and correct common past perfect errors',
  order: 14,
  xpReward: 20,
  grammarPoint: 'Avoiding past perfect mistakes',
  vocabularyWords: ['had', 'have', 'has', 'did', 'past participle', 'past simple', 'sequence', 'order'],
  exercises: [
    {
      id: 'b2-u2-l14-e1',
      type: 'error-correction',
      instruction: 'Find and correct the error',
      sentence: 'When I arrived, she has already left.',
      correctAnswer: 'When I arrived, she had already left.',
      explanation: 'Use past perfect "had", not present perfect "has" with past time.',
      points: 10,
    },
    {
      id: 'b2-u2-l14-e2',
      type: 'error-correction',
      instruction: 'Find and correct the error',
      sentence: 'By the time we got there, the movie started.',
      correctAnswer: 'By the time we got there, the movie had started.',
      explanation: 'Use past perfect "had started" for the earlier action.',
      points: 10,
    },
    {
      id: 'b2-u2-l14-e3',
      type: 'error-correction',
      instruction: 'Find and correct the error',
      sentence: 'She was tired because she worked all day.',
      correctAnswer: 'She was tired because she had worked all day.',
      explanation: 'Use past perfect "had worked" for the earlier cause.',
      points: 10,
    },
    {
      id: 'b2-u2-l14-e4',
      type: 'multiple-choice',
      instruction: 'Select the correct answer',
      question: 'Which is correct?',
      options: ['He had gone before I arrived', 'He gone before I arrived', 'He had went before I arrived', 'He has gone before I arrived'],
      correctAnswer: 0,
      explanation: 'Past perfect: had + past participle (gone, not went).',
      points: 10,
    },
    {
      id: 'b2-u2-l14-e5',
      type: 'error-correction',
      instruction: 'Find and correct the error',
      sentence: 'Had you ever been to Spain before you moved there?',
      correctAnswer: 'Had you ever been to Spain before you moved there?',
      explanation: 'This sentence is actually correct!',
      points: 10,
    },
    {
      id: 'b2-u2-l14-e6',
      type: 'multiple-choice',
      instruction: 'Choose the correct form',
      question: 'What\'s wrong with: "If I would have known, I would have told you"?',
      options: ['Use "had known" not "would have known" in if-clause', 'Use "knew" not "would have known"', 'Use "have known" not "would have known"', 'Nothing is wrong'],
      correctAnswer: 0,
      explanation: 'Third conditional if-clause uses past perfect, not "would have".',
      points: 10,
    },
    {
      id: 'b2-u2-l14-e7',
      type: 'error-correction',
      instruction: 'Find and correct the error',
      sentence: 'She told me she has finished the project.',
      correctAnswer: 'She told me she had finished the project.',
      explanation: 'Reported speech with past reporting verb uses past perfect "had finished".',
      points: 10,
    },
    {
      id: 'b2-u2-l14-e8',
      type: 'true-false',
      instruction: 'Is this statement correct?',
      statement: 'Past perfect always uses "had" + past participle, never "has" or "have".',
      correctAnswer: true,
      explanation: 'Yes, past perfect only uses "had" for all subjects.',
      points: 10,
    },
    {
      id: 'b2-u2-l14-e9',
      type: 'error-correction',
      instruction: 'Find and correct the error',
      sentence: 'They didn\'t had eaten before the meeting.',
      correctAnswer: 'They hadn\'t eaten before the meeting.',
      explanation: 'Negative past perfect: hadn\'t (not didn\'t had) + past participle.',
      points: 10,
    },
    {
      id: 'b2-u2-l14-e10',
      type: 'multiple-choice',
      instruction: 'Select the correct answer',
      question: 'Which sentence correctly uses past perfect?',
      options: ['After I had studied, I went to bed', 'After I have studied, I went to bed', 'After I studied, I had gone to bed', 'After I had study, I went to bed'],
      correctAnswer: 0,
      explanation: 'Earlier action uses past perfect; later action uses past simple.',
      points: 10,
    },
  ],
};

// ============================================
// LESSON 15: Comprehensive Review
// ============================================
const lesson15: Lesson = {
  id: 'b2-u2-l15',
  unitId: 'b2-u2',
  title: 'Comprehensive Review',
  description: 'Complete review of past perfect tense',
  order: 15,
  xpReward: 30,
  grammarPoint: 'Complete unit review',
  vocabularyWords: ['had', 'past participle', 'earlier action', 'sequence', 'before', 'after', 'by the time', 'already', 'just', 'never'],
  exercises: [
    {
      id: 'b2-u2-l15-e1',
      type: 'multiple-choice',
      instruction: 'Select the correct answer',
      question: 'How do we form past perfect?',
      options: ['had + past participle', 'have + past participle', 'had + past simple', 'has + past participle'],
      correctAnswer: 0,
      explanation: 'Past perfect: had + past participle for all subjects.',
      points: 10,
    },
    {
      id: 'b2-u2-l15-e2',
      type: 'fill-blank',
      instruction: 'Complete the sentence with the correct form',
      question: 'By the time I ___ (arrive), everyone ___ (leave).',
      correctAnswer: 'arrived, had left',
      explanation: 'Later action: past simple; earlier action: past perfect.',
      points: 10,
    },
    {
      id: 'b2-u2-l15-e3',
      type: 'matching',
      instruction: 'Match the usage with the example',
      pairs: [
        { left: 'Earlier past action', right: 'When I arrived, she had left' },
        { left: 'Reported speech', right: 'He said he had finished' },
        { left: 'Third conditional', right: 'If I had known, I would have helped' },
        { left: 'Unfulfilled plan', right: 'I had hoped to see you' },
      ],
      explanation: 'Past perfect has multiple uses in English.',
      points: 10,
    },
    {
      id: 'b2-u2-l15-e4',
      type: 'word-order',
      instruction: 'Put the words in the correct order',
      words: ['because', 'tired', 'was', 'She', 'slept', 'had', 'not', 'she'],
      correctOrder: [3, 2, 1, 0, 7, 5, 6, 4],
      explanation: 'She was tired because she had not slept.',
      points: 10,
    },
    {
      id: 'b2-u2-l15-e5',
      type: 'error-correction',
      instruction: 'Find and correct the error',
      sentence: 'After she has finished her work, she went home yesterday.',
      correctAnswer: 'After she had finished her work, she went home yesterday.',
      explanation: 'Use past perfect "had finished" with past time reference.',
      points: 10,
    },
    {
      id: 'b2-u2-l15-e6',
      type: 'fill-blank',
      instruction: 'Complete the sentence with the correct form',
      question: 'They were excited because they ___ never ___ (see) the ocean before.',
      correctAnswer: 'had, seen',
      explanation: 'Past perfect shows this was their first experience up to that point.',
      points: 10,
    },
    {
      id: 'b2-u2-l15-e7',
      type: 'multiple-choice',
      instruction: 'Select the correct answer',
      question: 'Which time marker is commonly used with past perfect?',
      options: ['By the time', 'Tomorrow', 'Next week', 'Every day'],
      correctAnswer: 0,
      explanation: '"By the time" shows completion before a past reference point.',
      points: 10,
    },
    {
      id: 'b2-u2-l15-e8',
      type: 'true-false',
      instruction: 'Is this statement correct?',
      statement: 'Past perfect shows an action that happened before another past action.',
      correctAnswer: true,
      explanation: 'Yes, this is the primary function of past perfect.',
      points: 10,
    },
    {
      id: 'b2-u2-l15-e9',
      type: 'translation',
      instruction: 'Translate to English',
      question: 'Cuando llegué a casa, me di cuenta de que había olvidado mis llaves.',
      correctAnswer: 'When I got home, I realized I had forgotten my keys',
      acceptableAnswers: ['When I got home, I realized I had forgotten my keys.', 'When I arrived home, I realized I had forgotten my keys', 'When I arrived home, I realized I had forgotten my keys.'],
      explanation: '"Había olvidado" = "had forgotten" (past perfect for earlier action).',
      points: 10,
    },
    {
      id: 'b2-u2-l15-e10',
      type: 'fill-blank',
      instruction: 'Complete the sentence with the correct form',
      question: 'If you ___ (tell) me earlier, I ___ (help) you.',
      correctAnswer: 'had told, would have helped',
      acceptableAnswers: ['had told, could have helped'],
      explanation: 'Third conditional: If + past perfect, would/could have + past participle.',
      points: 10,
    },
  ],
};

// ============================================
// UNIT EXPORT
// ============================================
export const unit2: Unit = {
  id: 'b2-u2',
  levelId: 'b2',
  title: 'Past Perfect',
  description: 'Learn to talk about actions that happened before other past actions',
  order: 2,
  totalLessons: 15,
  icon: '⏮️',
  lessons: [
    lesson1,
    lesson2,
    lesson3,
    lesson4,
    lesson5,
    lesson6,
    lesson7,
    lesson8,
    lesson9,
    lesson10,
    lesson11,
    lesson12,
    lesson13,
    lesson14,
    lesson15,
  ],
};
